#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "protos"
require "benchmark"
require "benchmark/ips"
require "benchmark/memory"

class PhlexTable < Phlex::HTML
  def view_template
    table do
      thead do
        tr do
          th { "Name" }
          th { "Age" }
        end
      end

      tbody do
        100.times do |i|
          tr do
            td { "John Doe" }
            td { i }
          end
        end
      end

      tfoot do
        tr do
          td { "Total" }
          td { 100 }
        end
      end
    end
  end
end

class ProtosTable < Protos::Component
  def view_template
    render Protos::Table.new do |table|
      table.header do
        table.row do
          table.head { "Name" }
          table.head { "Age" }
        end
      end

      table.body do
        100.times do |i|
          table.row do
            table.cell { "John Doe" }
            table.cell { i }
          end
        end
      end

      table.footer do
        table.row do
          table.cell { "Total" }
          table.cell { 100 }
        end
      end
    end
  end
end


Benchmark.ips do |x|
  x.report("Protos::Table") do
    ProtosTable.new.call
  end

  x.report("Phlex::Table") do
    PhlexTable.new.call
  end

  x.compare!
end

Benchmark.memory do |x|
  x.report("Protos::Table") do
    ProtosTable.new.call
  end

  x.report("Phlex::Table") do
    PhlexTable.new.call
  end

  x.compare!
end
